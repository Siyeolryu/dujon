# í˜„ì¥ë°°ì • ê´€ë¦¬ ì‹œìŠ¤í…œ - Phase 2 ê°œë°œ ê³„íš

## ğŸ“‹ í”„ë¡œì íŠ¸ í˜„í™©

### âœ… Phase 1 ì™„ë£Œ ì‚¬í•­ (2026ë…„ 1ì›”)
- Google Sheets API ì—°ë™ ëª¨ë“ˆ ê°œë°œ ì™„ë£Œ
- OAuth2 ì¸ì¦ êµ¬í˜„ ì™„ë£Œ
- CSV ë°ì´í„° ì—…ë¡œë“œ ì™„ë£Œ (1,182ê°œ ì…€)
- 3ê°œ ì‹œíŠ¸ êµ¬ì¡° êµ¬ì¶• ì™„ë£Œ
  - ì‹œíŠ¸1: í˜„ì¥ì •ë³´ (31í–‰)
  - ì‹œíŠ¸2: ì¸ë ¥í’€ (21ëª…)
  - ì‹œíŠ¸3: ìê²©ì¦í’€ (31ê°œ)

### ğŸ¯ Phase 2 ëª©í‘œ
Google Sheetsë¥¼ ì™„ì „í•œ ë°ì´í„°ë² ì´ìŠ¤ë¡œ ì „í™˜í•˜ê³ , HTML ì•±ê³¼ ì‹¤ì‹œê°„ ì—°ë™

---

## ğŸš€ Phase 2 ê°œë°œ ë‹¨ê³„

### 1ë‹¨ê³„: Google Sheets ê³ ê¸‰ ê¸°ëŠ¥ ì ìš© (1-2ì¼)

#### 1-1. ë°ì´í„° ê²€ì¦ ê·œì¹™ ìë™ ì„¤ì •
**ëª©í‘œ**: ì˜ëª»ëœ ë°ì´í„° ì…ë ¥ ë°©ì§€

**ê°œë°œ íŒŒì¼**: `apply_data_validation.py`

**ì ìš©í•  ê²€ì¦ ê·œì¹™**:

```python
# í˜„ì¥ì •ë³´ ì‹œíŠ¸ (ì‹œíŠ¸1)
VALIDATIONS = {
    'íšŒì‚¬êµ¬ë¶„': {
        'column': 'C',
        'type': 'ONE_OF_LIST',
        'values': ['ë”ì¡´ì¢…í•©ê±´ì„¤', 'ë”ì¡´í•˜ìš°ì§•']
    },
    'í˜„ì¥ìƒíƒœ': {
        'column': 'J',
        'type': 'ONE_OF_LIST',
        'values': ['ê±´ì¶•í—ˆê°€', 'ì°©ê³µì˜ˆì •', 'ì°©ê³µì¤‘', 'ì¤€ê³µ']
    },
    'ë°°ì •ìƒíƒœ': {
        'column': 'O',
        'type': 'ONE_OF_LIST',
        'values': ['ë°°ì •ì™„ë£Œ', 'ë¯¸ë°°ì •']
    }
}

# ì¸ë ¥í’€ ì‹œíŠ¸ (ì‹œíŠ¸2)
PERSONNEL_VALIDATIONS = {
    'ì§ì±…': {
        'column': 'C',
        'values': ['ì†Œì¥', 'ì‚¬ë¬´ì‹¤ì¥', 'ì‚¬ë¬´ì§ì›', 'ê¸°íƒ€']
    },
    'í˜„ì¬ìƒíƒœ': {
        'column': 'H',
        'values': ['íˆ¬ì…ê°€ëŠ¥', 'íˆ¬ì…ì¤‘', 'íœ´ê°€', 'í‡´ì‚¬']
    }
}

# ìê²©ì¦í’€ ì‹œíŠ¸ (ì‹œíŠ¸3)
CERT_VALIDATIONS = {
    'ì‚¬ìš©ê°€ëŠ¥ì—¬ë¶€': {
        'column': 'J',
        'values': ['ì‚¬ìš©ê°€ëŠ¥', 'ì‚¬ìš©ì¤‘', 'ë§Œë£Œ']
    }
}
```

**ì£¼ìš” ê¸°ëŠ¥**:
- ë“œë¡­ë‹¤ìš´ ëª©ë¡ ìë™ ì„¤ì •
- ë‚ ì§œ í˜•ì‹ ê²€ì¦ (YYYY-MM-DD)
- ì „í™”ë²ˆí˜¸ í˜•ì‹ ê²€ì¦ (010-XXXX-XXXX)
- ì´ë©”ì¼ í˜•ì‹ ê²€ì¦

---

#### 1-2. ì¡°ê±´ë¶€ ì„œì‹ ìë™ ì ìš©
**ëª©í‘œ**: ì‹œê°ì ìœ¼ë¡œ êµ¬ë¶„ ê°€ëŠ¥í•œ ë°ì´í„°ë² ì´ìŠ¤

**ê°œë°œ íŒŒì¼**: `apply_conditional_formatting.py`

**ì ìš©í•  ì„œì‹**:

```python
CONDITIONAL_FORMATS = {
    # í˜„ì¥ì •ë³´ - ë°°ì •ìƒíƒœ
    'ë°°ì •ìƒíƒœ_ë¯¸ë°°ì •': {
        'sheet': 'ì‹œíŠ¸1',
        'column': 'O',
        'condition': 'TEXT_EQ',
        'value': 'ë¯¸ë°°ì •',
        'background_color': {'red': 0.96, 'green': 0.8, 'blue': 0.8}  # ì—°í•œ ë¹¨ê°•
    },
    'ë°°ì •ìƒíƒœ_ë°°ì •ì™„ë£Œ': {
        'sheet': 'ì‹œíŠ¸1',
        'column': 'O',
        'condition': 'TEXT_EQ',
        'value': 'ë°°ì •ì™„ë£Œ',
        'background_color': {'red': 0.85, 'green': 0.92, 'blue': 0.83}  # ì—°í•œ ì´ˆë¡
    },
    
    # í˜„ì¥ì •ë³´ - í˜„ì¥ìƒíƒœ
    'í˜„ì¥ìƒíƒœ_ê±´ì¶•í—ˆê°€': {
        'sheet': 'ì‹œíŠ¸1',
        'column': 'J',
        'condition': 'TEXT_EQ',
        'value': 'ê±´ì¶•í—ˆê°€',
        'background_color': {'red': 0.81, 'green': 0.89, 'blue': 0.95}  # ì—°í•œ íŒŒë‘
    },
    'í˜„ì¥ìƒíƒœ_ì°©ê³µ': {
        'sheet': 'ì‹œíŠ¸1',
        'column': 'J',
        'condition': 'TEXT_CONTAINS',
        'value': 'ì°©ê³µ',
        'background_color': {'red': 0.99, 'green': 0.9, 'blue': 0.8}  # ì—°í•œ ì£¼í™©
    },
    'í˜„ì¥ìƒíƒœ_ì¤€ê³µ': {
        'sheet': 'ì‹œíŠ¸1',
        'column': 'J',
        'condition': 'TEXT_EQ',
        'value': 'ì¤€ê³µ',
        'background_color': {'red': 0.85, 'green': 0.92, 'blue': 0.83}  # ì—°í•œ ì´ˆë¡
    },
    
    # ì¸ë ¥í’€ - í˜„ì¬ìƒíƒœ
    'ì¸ë ¥_íˆ¬ì…ê°€ëŠ¥': {
        'sheet': 'ì‹œíŠ¸2',
        'column': 'H',
        'condition': 'TEXT_EQ',
        'value': 'íˆ¬ì…ê°€ëŠ¥',
        'background_color': {'red': 0.85, 'green': 0.92, 'blue': 0.83}
    },
    'ì¸ë ¥_íˆ¬ì…ì¤‘': {
        'sheet': 'ì‹œíŠ¸2',
        'column': 'H',
        'condition': 'TEXT_EQ',
        'value': 'íˆ¬ì…ì¤‘',
        'background_color': {'red': 1.0, 'green': 0.95, 'blue': 0.8}  # ì—°í•œ ë…¸ë‘
    },
    
    # ìê²©ì¦í’€ - ì‚¬ìš©ê°€ëŠ¥ì—¬ë¶€
    'ìê²©ì¦_ì‚¬ìš©ê°€ëŠ¥': {
        'sheet': 'ì‹œíŠ¸3',
        'column': 'J',
        'condition': 'TEXT_EQ',
        'value': 'ì‚¬ìš©ê°€ëŠ¥',
        'background_color': {'red': 0.85, 'green': 0.92, 'blue': 0.83}
    },
    'ìê²©ì¦_ì‚¬ìš©ì¤‘': {
        'sheet': 'ì‹œíŠ¸3',
        'column': 'J',
        'condition': 'TEXT_EQ',
        'value': 'ì‚¬ìš©ì¤‘',
        'background_color': {'red': 1.0, 'green': 0.95, 'blue': 0.8}
    }
}
```

**ì¶”ê°€ ì„œì‹**:
- í—¤ë” í–‰ ê³ ì • ë° ë°°ê²½ìƒ‰ ì ìš©
- ë‚ ì§œ ì§€ë‚˜ê°„ í˜„ì¥ ê°•ì¡° (ì°©ê³µì˜ˆì •ì¼ < ì˜¤ëŠ˜)
- ì¤‘ë³µ ID ê²½ê³  í‘œì‹œ

---

#### 1-3. VLOOKUP ìˆ˜ì‹ ìë™ ì¶”ê°€
**ëª©í‘œ**: ì°¸ì¡° ë°ì´í„° ìë™ ì¡°íšŒ

**ê°œë°œ íŒŒì¼**: `apply_formulas.py`

**ì ìš©í•  ìˆ˜ì‹**:

```python
FORMULAS = {
    # í˜„ì¥ì •ë³´ ì‹œíŠ¸ì— ì¶”ê°€í•  ì»¬ëŸ¼ ë° ìˆ˜ì‹
    'ë‹´ë‹¹ì†Œì¥ëª…': {
        'sheet': 'ì‹œíŠ¸1',
        'insert_after_column': 'L',  # ë‹´ë‹¹ì†Œì¥ID ë‹¤ìŒ
        'formula': '=IF(ISBLANK(L{row}),"",VLOOKUP(L{row},ì‹œíŠ¸2!A:B,2,FALSE))'
    },
    'ë‹´ë‹¹ì†Œì¥ì—°ë½ì²˜': {
        'sheet': 'ì‹œíŠ¸1',
        'insert_after_column': 'M',  # ë‹´ë‹¹ì†Œì¥ëª… ë‹¤ìŒ
        'formula': '=IF(ISBLANK(L{row}),"",VLOOKUP(L{row},ì‹œíŠ¸2!A:E,5,FALSE))'
    },
    'ìê²©ì¦ëª…': {
        'sheet': 'ì‹œíŠ¸1',
        'insert_after_column': 'P',  # ì‚¬ìš©ìê²©ì¦ID ë‹¤ìŒ
        'formula': '=IF(ISBLANK(P{row}),"",VLOOKUP(P{row},ì‹œíŠ¸3!A:B,2,FALSE))'
    },
    'ìê²©ì¦ì†Œìœ ìëª…': {
        'sheet': 'ì‹œíŠ¸1',
        'insert_after_column': 'Q',
        'formula': '=IF(ISBLANK(P{row}),"",VLOOKUP(P{row},ì‹œíŠ¸3!A:E,5,FALSE))'
    },
    'ìê²©ì¦ì†Œìœ ìì—°ë½ì²˜': {
        'sheet': 'ì‹œíŠ¸1',
        'insert_after_column': 'R',
        'formula': '=IF(ISBLANK(P{row}),"",VLOOKUP(P{row},ì‹œíŠ¸3!A:F,6,FALSE))'
    }
}
```

**ì˜ˆìƒ ê²°ê³¼**:
- ë‹´ë‹¹ì†Œì¥ID ì…ë ¥ ì‹œ â†’ ì†Œì¥ëª…, ì—°ë½ì²˜ ìë™ í‘œì‹œ
- ì‚¬ìš©ìê²©ì¦ID ì…ë ¥ ì‹œ â†’ ìê²©ì¦ëª…, ì†Œìœ ìëª…, ì—°ë½ì²˜ ìë™ í‘œì‹œ
- ì˜ëª»ëœ ID ì…ë ¥ ì‹œ â†’ #N/A ì˜¤ë¥˜ë¡œ ì¦‰ì‹œ í™•ì¸ ê°€ëŠ¥

---

### 2ë‹¨ê³„: ì‹¤ì‹œê°„ ë°ì´í„° ì—°ë™ API ê°œë°œ (2-3ì¼)

#### 2-1. Google Sheets â†’ HTML ì•± ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
**ëª©í‘œ**: HTML ì•±ì—ì„œ ì‹¤ì‹œê°„ìœ¼ë¡œ Google Sheets ë°ì´í„° ì¡°íšŒ

**ê°œë°œ íŒŒì¼**: `sheets_to_app_api.py`

**ì£¼ìš” ì—”ë“œí¬ì¸íŠ¸**:

```python
# Flask REST API ì„œë²„
from flask import Flask, jsonify, request
from flask_cors import CORS

app = Flask(__name__)
CORS(app)  # CORS í—ˆìš©

@app.route('/api/sites', methods=['GET'])
def get_sites():
    """í˜„ì¥ì •ë³´ ì „ì²´ ì¡°íšŒ"""
    # í•„í„°ë§ ì§€ì›
    company = request.args.get('company')  # ì¢…í•©/í•˜ìš°ì§•
    status = request.args.get('status')    # ë°°ì •ì™„ë£Œ/ë¯¸ë°°ì •
    
    # Google Sheetsì—ì„œ ë°ì´í„° ì½ê¸°
    sites = sheets_api.get_sites()
    
    # í•„í„°ë§ ì ìš©
    if company:
        sites = [s for s in sites if s['íšŒì‚¬êµ¬ë¶„'] == company]
    if status:
        sites = [s for s in sites if s['ë°°ì •ìƒíƒœ'] == status]
    
    return jsonify(sites)

@app.route('/api/sites/<site_id>', methods=['GET'])
def get_site_detail(site_id):
    """í˜„ì¥ ìƒì„¸ì •ë³´ ì¡°íšŒ (ê´€ê³„ ë°ì´í„° í¬í•¨)"""
    # í˜„ì¥ ì •ë³´
    site = sheets_api.get_site_by_id(site_id)
    
    # ë‹´ë‹¹ì†Œì¥ ì •ë³´ (ìˆëŠ” ê²½ìš°)
    if site['ë‹´ë‹¹ì†Œì¥ID']:
        site['manager'] = sheets_api.get_personnel_by_id(site['ë‹´ë‹¹ì†Œì¥ID'])
    
    # ì‚¬ìš©ìê²©ì¦ ì •ë³´ (ìˆëŠ” ê²½ìš°)
    if site['ì‚¬ìš©ìê²©ì¦ID']:
        site['certificate'] = sheets_api.get_certificate_by_id(site['ì‚¬ìš©ìê²©ì¦ID'])
    
    return jsonify(site)

@app.route('/api/personnel', methods=['GET'])
def get_personnel():
    """ì¸ë ¥í’€ ì „ì²´ ì¡°íšŒ"""
    status = request.args.get('status')  # íˆ¬ì…ê°€ëŠ¥/íˆ¬ì…ì¤‘ ë“±
    role = request.args.get('role')      # ì†Œì¥/ì‚¬ë¬´ì§ì›
    
    personnel = sheets_api.get_personnel()
    
    if status:
        personnel = [p for p in personnel if p['í˜„ì¬ìƒíƒœ'] == status]
    if role:
        personnel = [p for p in personnel if p['ì§ì±…'] == role]
    
    return jsonify(personnel)

@app.route('/api/certificates', methods=['GET'])
def get_certificates():
    """ìê²©ì¦í’€ ì „ì²´ ì¡°íšŒ"""
    available = request.args.get('available')  # true/false
    
    certificates = sheets_api.get_certificates()
    
    if available == 'true':
        certificates = [c for c in certificates if c['ì‚¬ìš©ê°€ëŠ¥ì—¬ë¶€'] == 'ì‚¬ìš©ê°€ëŠ¥']
    
    return jsonify(certificates)

@app.route('/api/stats', methods=['GET'])
def get_statistics():
    """í†µê³„ ì •ë³´"""
    sites = sheets_api.get_sites()
    personnel = sheets_api.get_personnel()
    certificates = sheets_api.get_certificates()
    
    stats = {
        'total_sites': len(sites),
        'assigned_sites': len([s for s in sites if s['ë°°ì •ìƒíƒœ'] == 'ë°°ì •ì™„ë£Œ']),
        'unassigned_sites': len([s for s in sites if s['ë°°ì •ìƒíƒœ'] == 'ë¯¸ë°°ì •']),
        'total_personnel': len(personnel),
        'available_personnel': len([p for p in personnel if p['í˜„ì¬ìƒíƒœ'] == 'íˆ¬ì…ê°€ëŠ¥']),
        'total_certificates': len(certificates),
        'available_certificates': len([c for c in certificates if c['ì‚¬ìš©ê°€ëŠ¥ì—¬ë¶€'] == 'ì‚¬ìš©ê°€ëŠ¥'])
    }
    
    return jsonify(stats)
```

---

#### 2-2. HTML ì•± â†’ Google Sheets ë°ì´í„° ìˆ˜ì •
**ëª©í‘œ**: ì•±ì—ì„œ ì§ì ‘ ë°ì´í„° ìˆ˜ì • ê°€ëŠ¥

**ì¶”ê°€ ì—”ë“œí¬ì¸íŠ¸**:

```python
@app.route('/api/sites/<site_id>', methods=['PUT'])
def update_site(site_id):
    """í˜„ì¥ ì •ë³´ ìˆ˜ì •"""
    data = request.json
    
    # Google Sheetsì—ì„œ í˜„ì¥ ì°¾ê¸°
    row_index = sheets_api.find_site_row(site_id)
    
    # ìˆ˜ì •í•  í•„ë“œ ì—…ë°ì´íŠ¸
    updates = []
    for field, value in data.items():
        col_index = FIELD_TO_COLUMN[field]
        updates.append({
            'range': f'ì‹œíŠ¸1!{col_index}{row_index}',
            'values': [[value]]
        })
    
    # ì¼ê´„ ì—…ë°ì´íŠ¸
    sheets_api.batch_update(updates)
    
    # ìˆ˜ì •ì¼ ìë™ ì—…ë°ì´íŠ¸
    sheets_api.update_cell(f'ì‹œíŠ¸1!Q{row_index}', datetime.now().strftime('%Y-%m-%d'))
    
    return jsonify({'success': True})

@app.route('/api/sites/<site_id>/assign', methods=['POST'])
def assign_manager(site_id):
    """ì†Œì¥ ë°°ì •"""
    data = request.json
    manager_id = data['manager_id']
    certificate_id = data['certificate_id']
    
    # í˜„ì¥ì— ì†Œì¥ ë°°ì •
    row_index = sheets_api.find_site_row(site_id)
    sheets_api.update_cell(f'ì‹œíŠ¸1!L{row_index}', manager_id)
    sheets_api.update_cell(f'ì‹œíŠ¸1!P{row_index}', certificate_id)
    sheets_api.update_cell(f'ì‹œíŠ¸1!O{row_index}', 'ë°°ì •ì™„ë£Œ')
    
    # ì†Œì¥ ìƒíƒœ ì—…ë°ì´íŠ¸
    manager_row = sheets_api.find_personnel_row(manager_id)
    current_count = int(sheets_api.get_cell(f'ì‹œíŠ¸2!I{manager_row}') or 0)
    sheets_api.update_cell(f'ì‹œíŠ¸2!I{manager_row}', current_count + 1)
    sheets_api.update_cell(f'ì‹œíŠ¸2!H{manager_row}', 'íˆ¬ì…ì¤‘')
    
    # ìê²©ì¦ ìƒíƒœ ì—…ë°ì´íŠ¸
    cert_row = sheets_api.find_certificate_row(certificate_id)
    sheets_api.update_cell(f'ì‹œíŠ¸3!J{cert_row}', 'ì‚¬ìš©ì¤‘')
    sheets_api.update_cell(f'ì‹œíŠ¸3!K{cert_row}', site_id)
    
    return jsonify({'success': True})
```

---

#### 2-3. ì‹¤ì‹œê°„ ë™ê¸°í™” êµ¬í˜„
**ëª©í‘œ**: ì—¬ëŸ¬ ì‚¬ìš©ìê°€ ë™ì‹œ ì‚¬ìš© ì‹œ ë°ì´í„° ì¶©ëŒ ë°©ì§€

**ê°œë°œ íŒŒì¼**: `sync_manager.py`

**ì£¼ìš” ê¸°ëŠ¥**:
- ë‚™ê´€ì  ì ê¸ˆ (Optimistic Locking) êµ¬í˜„
- ë³€ê²½ ì´ë ¥ ì¶”ì 
- ì¶©ëŒ ê°ì§€ ë° í•´ê²°

```python
class SyncManager:
    def __init__(self):
        self.version_cache = {}
    
    def check_version(self, sheet, row, expected_version):
        """ë²„ì „ í™•ì¸"""
        current_version = self.get_version(sheet, row)
        return current_version == expected_version
    
    def update_with_version(self, sheet, row, data, version):
        """ë²„ì „ ì²´í¬ í›„ ì—…ë°ì´íŠ¸"""
        if not self.check_version(sheet, row, version):
            raise ConflictError("ë°ì´í„°ê°€ ë‹¤ë¥¸ ì‚¬ìš©ìì— ì˜í•´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.")
        
        # ì—…ë°ì´íŠ¸ ìˆ˜í–‰
        self.sheets_api.update_row(sheet, row, data)
        
        # ë²„ì „ ì¦ê°€
        new_version = version + 1
        self.update_version(sheet, row, new_version)
        
        return new_version
```

---

### 3ë‹¨ê³„: HTML ì•± ê°œì„  (2-3ì¼)

#### 3-1. Google Sheets APIì™€ ì—°ë™
**ìˆ˜ì • íŒŒì¼**: `app.js`

**ì£¼ìš” ë³€ê²½ì‚¬í•­**:

```javascript
// ê¸°ì¡´: ë¡œì»¬ ë°ì´í„° ì‚¬ìš©
// const sitesData = [...];

// ë³€ê²½: APIì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
const API_BASE_URL = 'http://localhost:5000/api';

async function loadSitesData() {
    try {
        const response = await fetch(`${API_BASE_URL}/sites`);
        const data = await response.json();
        return data;
    } catch (error) {
        console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
        return [];
    }
}

// í•„í„°ë§ ì‹œ API í˜¸ì¶œ
async function applyFilters() {
    const company = currentFilter.company === 'all' ? '' : currentFilter.company;
    const status = currentFilter.status === 'all' ? '' : currentFilter.status;
    
    const url = `${API_BASE_URL}/sites?company=${company}&status=${status}`;
    const sites = await fetch(url).then(r => r.json());
    
    renderMap(sites);
    updateStats(sites);
}

// ì†Œì¥ ë°°ì • ê¸°ëŠ¥
async function assignManager(siteId, managerId, certificateId) {
    try {
        const response = await fetch(`${API_BASE_URL}/sites/${siteId}/assign`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ manager_id: managerId, certificate_id: certificateId })
        });
        
        if (response.ok) {
            alert('ì†Œì¥ì´ ë°°ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
            await loadSitesData();  // ë°ì´í„° ìƒˆë¡œê³ ì¹¨
        }
    } catch (error) {
        console.error('ë°°ì • ì‹¤íŒ¨:', error);
    }
}
```

---

#### 3-2. ì†Œì¥ ë°°ì • UI ì¶”ê°€
**ìƒˆë¡œìš´ ê¸°ëŠ¥**: ì•±ì—ì„œ ì§ì ‘ ì†Œì¥ ë°°ì •

**HTML ì¶”ê°€**:

```html
<!-- ì†Œì¥ ë°°ì • íŒ¨ë„ -->
<div id="assignPanel" class="assign-panel">
    <div class="panel-header">
        <h3>ì†Œì¥ ë°°ì •</h3>
        <button id="closeAssign" class="close-btn">âœ•</button>
    </div>
    <div class="panel-content">
        <div class="assign-section">
            <h4>í˜„ì¥ ì •ë³´</h4>
            <p id="assignSiteName"></p>
        </div>
        
        <div class="assign-section">
            <h4>ì†Œì¥ ì„ íƒ</h4>
            <select id="managerSelect" class="form-select">
                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
            </select>
            <div id="managerInfo" class="info-display"></div>
        </div>
        
        <div class="assign-section">
            <h4>ìê²©ì¦ ì„ íƒ</h4>
            <select id="certificateSelect" class="form-select">
                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
            </select>
            <div id="certificateInfo" class="info-display"></div>
        </div>
        
        <button id="confirmAssign" class="action-btn">ë°°ì • í™•ì¸</button>
    </div>
</div>
```

**JavaScript ì¶”ê°€**:

```javascript
// ì†Œì¥ ë°°ì • íŒ¨ë„ ì—´ê¸°
async function openAssignPanel(site) {
    selectedSite = site;
    
    // íˆ¬ì…ê°€ëŠ¥í•œ ì†Œì¥ ëª©ë¡ ë¡œë“œ
    const personnel = await fetch(`${API_BASE_URL}/personnel?status=íˆ¬ì…ê°€ëŠ¥`)
        .then(r => r.json());
    
    const managerSelect = document.getElementById('managerSelect');
    managerSelect.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>';
    personnel.forEach(p => {
        const option = document.createElement('option');
        option.value = p.ì¸ë ¥ID;
        option.textContent = `${p.ì„±ëª…} (${p.ì§ì±…})`;
        managerSelect.appendChild(option);
    });
    
    // ì‚¬ìš©ê°€ëŠ¥í•œ ìê²©ì¦ ëª©ë¡ ë¡œë“œ
    const certificates = await fetch(`${API_BASE_URL}/certificates?available=true`)
        .then(r => r.json());
    
    const certSelect = document.getElementById('certificateSelect');
    certSelect.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>';
    certificates.forEach(c => {
        const option = document.createElement('option');
        option.value = c.ìê²©ì¦ID;
        option.textContent = `${c.ìê²©ì¦ëª…} - ${c.ì†Œìœ ìëª…}`;
        certSelect.appendChild(option);
    });
    
    document.getElementById('assignPanel').classList.add('active');
}

// ë°°ì • í™•ì¸
document.getElementById('confirmAssign').addEventListener('click', async function() {
    const managerId = document.getElementById('managerSelect').value;
    const certificateId = document.getElementById('certificateSelect').value;
    
    if (!managerId || !certificateId) {
        alert('ì†Œì¥ê³¼ ìê²©ì¦ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
    }
    
    await assignManager(selectedSite.id, managerId, certificateId);
    document.getElementById('assignPanel').classList.remove('active');
});
```

---

#### 3-3. ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ êµ¬í˜„
**ê¸°ìˆ **: Server-Sent Events (SSE) ë˜ëŠ” WebSocket

```javascript
// SSEë¥¼ í†µí•œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
const eventSource = new EventSource(`${API_BASE_URL}/stream`);

eventSource.onmessage = function(event) {
    const update = JSON.parse(event.data);
    
    if (update.type === 'site_updated') {
        // í˜„ì¥ ì •ë³´ ì—…ë°ì´íŠ¸
        updateSiteOnMap(update.data);
    } else if (update.type === 'assignment_changed') {
        // ë°°ì • ìƒíƒœ ë³€ê²½
        refreshData();
    }
};
```

---

### 4ë‹¨ê³„: ë°°í¬ ë° í…ŒìŠ¤íŠ¸ (1-2ì¼)

#### 4-1. ë¡œì»¬ ì„œë²„ ì„¤ì •
**ê°œë°œ í™˜ê²½ êµ¬ì¶•**:

```bash
# ê°€ìƒí™˜ê²½ ìƒì„±
python -m venv venv

# ì˜ì¡´ì„± ì„¤ì¹˜
pip install -r requirements.txt

# í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
# .env íŒŒì¼ ìƒì„±
SPREADSHEET_ID=15fAEzkC9FCLA6sG1N--f69r-32WHoYLvmXcwED5xWzM
GOOGLE_API_KEY=AIzaSyBmQY3MXgpZT2UeHqaMHM6ecRKYV11ktLo
FLASK_PORT=5000

# ì„œë²„ ì‹¤í–‰
python sheets_to_app_api.py
```

#### 4-2. CORS ë° ë³´ì•ˆ ì„¤ì •

```python
# CORS ì„¤ì •
CORS(app, resources={
    r"/api/*": {
        "origins": ["http://localhost:8000", "http://127.0.0.1:8000"],
        "methods": ["GET", "POST", "PUT", "DELETE"],
        "allow_headers": ["Content-Type"]
    }
})

# API í‚¤ ê²€ì¦ (ì„ íƒì‚¬í•­)
@app.before_request
def verify_api_key():
    if request.path.startswith('/api/'):
        api_key = request.headers.get('X-API-Key')
        if api_key != os.getenv('API_KEY'):
            return jsonify({'error': 'Unauthorized'}), 401
```

#### 4-3. í†µí•© í…ŒìŠ¤íŠ¸

**í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤**:
1. âœ… í˜„ì¥ ëª©ë¡ ì¡°íšŒ (í•„í„°ë§ í¬í•¨)
2. âœ… í˜„ì¥ ìƒì„¸ì •ë³´ ì¡°íšŒ (ê´€ê³„ ë°ì´í„° í¬í•¨)
3. âœ… ì†Œì¥ ë°°ì • ê¸°ëŠ¥
4. âœ… ìê²©ì¦ ë°°ì • ê¸°ëŠ¥
5. âœ… í†µê³„ ì •ë³´ ì¡°íšŒ
6. âœ… ì‹¤ì‹œê°„ ë™ê¸°í™”

---

## ğŸ“Š ê°œë°œ ì¼ì •

| ë‹¨ê³„ | ì‘ì—… | ì˜ˆìƒ ê¸°ê°„ | ìš°ì„ ìˆœìœ„ |
|------|------|----------|---------|
| **1ë‹¨ê³„** | Google Sheets ê³ ê¸‰ ê¸°ëŠ¥ | 1-2ì¼ | ë†’ìŒ |
| 1-1 | ë°ì´í„° ê²€ì¦ ê·œì¹™ | 0.5ì¼ | ë†’ìŒ |
| 1-2 | ì¡°ê±´ë¶€ ì„œì‹ | 0.5ì¼ | ì¤‘ê°„ |
| 1-3 | VLOOKUP ìˆ˜ì‹ | 1ì¼ | ë†’ìŒ |
| **2ë‹¨ê³„** | ì‹¤ì‹œê°„ ë°ì´í„° ì—°ë™ API | 2-3ì¼ | ë†’ìŒ |
| 2-1 | ë°ì´í„° ì¡°íšŒ API | 1ì¼ | ë†’ìŒ |
| 2-2 | ë°ì´í„° ìˆ˜ì • API | 1ì¼ | ë†’ìŒ |
| 2-3 | ì‹¤ì‹œê°„ ë™ê¸°í™” | 1ì¼ | ì¤‘ê°„ |
| **3ë‹¨ê³„** | HTML ì•± ê°œì„  | 2-3ì¼ | ë†’ìŒ |
| 3-1 | API ì—°ë™ | 1ì¼ | ë†’ìŒ |
| 3-2 | ì†Œì¥ ë°°ì • UI | 1ì¼ | ë†’ìŒ |
| 3-3 | ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ | 1ì¼ | ì¤‘ê°„ |
| **4ë‹¨ê³„** | ë°°í¬ ë° í…ŒìŠ¤íŠ¸ | 1-2ì¼ | ë†’ìŒ |
| 4-1 | ë¡œì»¬ ì„œë²„ ì„¤ì • | 0.5ì¼ | ë†’ìŒ |
| 4-2 | ë³´ì•ˆ ì„¤ì • | 0.5ì¼ | ë†’ìŒ |
| 4-3 | í†µí•© í…ŒìŠ¤íŠ¸ | 1ì¼ | ë†’ìŒ |
| **ì´ ì˜ˆìƒ ê¸°ê°„** | | **6-10ì¼** | |

---

## ğŸ¯ ìš°ì„ ìˆœìœ„ë³„ ê°œë°œ ì „ëµ

### ğŸ”´ ìµœìš°ì„  (Phase 2A)
**ëª©í‘œ**: ê¸°ë³¸ ê¸°ëŠ¥ ì™„ì„± (3-4ì¼)
1. ë°ì´í„° ê²€ì¦ ê·œì¹™ ì ìš©
2. VLOOKUP ìˆ˜ì‹ ì¶”ê°€
3. ë°ì´í„° ì¡°íšŒ API ê°œë°œ
4. HTML ì•± API ì—°ë™

### ğŸŸ¡ ì¤‘ìš” (Phase 2B)
**ëª©í‘œ**: í•µì‹¬ ê¸°ëŠ¥ ì¶”ê°€ (2-3ì¼)
1. ì¡°ê±´ë¶€ ì„œì‹ ì ìš©
2. ë°ì´í„° ìˆ˜ì • API ê°œë°œ
3. ì†Œì¥ ë°°ì • UI ê°œë°œ

### ğŸŸ¢ ì„ íƒ (Phase 2C)
**ëª©í‘œ**: ê³ ê¸‰ ê¸°ëŠ¥ ì¶”ê°€ (2-3ì¼)
1. ì‹¤ì‹œê°„ ë™ê¸°í™”
2. ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ UI
3. ê³ ê¸‰ í†µê³„ ê¸°ëŠ¥

---

## ğŸ“ ì¶”ê°€ ê°œë°œ íŒŒì¼ ëª©ë¡

```
í˜„ì¥ë°°ì •í˜„í™©/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ apply_data_validation.py     # ë°ì´í„° ê²€ì¦ ì ìš©
â”‚   â”œâ”€â”€ apply_conditional_formatting.py  # ì¡°ê±´ë¶€ ì„œì‹ ì ìš©
â”‚   â”œâ”€â”€ apply_formulas.py            # ìˆ˜ì‹ ìë™ ì¶”ê°€
â”‚   â”œâ”€â”€ sheets_to_app_api.py         # Flask REST API ì„œë²„
â”‚   â”œâ”€â”€ sync_manager.py              # ë™ê¸°í™” ê´€ë¦¬ì
â”‚   â””â”€â”€ requirements_api.txt         # API ì„œë²„ ì˜ì¡´ì„±
â”‚
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ site-management.html         # ìˆ˜ì •ëœ HTML
â”‚   â”œâ”€â”€ app.js                       # ìˆ˜ì •ëœ JavaScript
â”‚   â”œâ”€â”€ style.css                    # ìˆ˜ì •ëœ CSS
â”‚   â””â”€â”€ config.js                    # API ì„¤ì •
â”‚
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ test_api.py                  # API í…ŒìŠ¤íŠ¸
â”‚   â”œâ”€â”€ test_sync.py                 # ë™ê¸°í™” í…ŒìŠ¤íŠ¸
â”‚   â””â”€â”€ test_integration.py          # í†µí•© í…ŒìŠ¤íŠ¸
â”‚
â””â”€â”€ docs/
    â”œâ”€â”€ API_ë¬¸ì„œ.md                   # API ì‚¬ìš© ê°€ì´ë“œ
    â”œâ”€â”€ ë°°í¬_ê°€ì´ë“œ.md                 # ë°°í¬ ê°€ì´ë“œ
    â””â”€â”€ ê°œë°œì¼ì§€_Phase2.md             # Phase 2 ê°œë°œ ì¼ì§€
```

---

## ğŸ” ê¸°ëŒ€ íš¨ê³¼

### ì‚¬ìš©ì ê²½í—˜ ê°œì„ 
1. âœ… **ì‹¤ì‹œê°„ ë°ì´í„°**: í•­ìƒ ìµœì‹  í˜„ì¥ ì •ë³´ í™•ì¸
2. âœ… **ì§ì ‘ ë°°ì •**: ì•±ì—ì„œ ì§ì ‘ ì†Œì¥ ë°°ì • ê°€ëŠ¥
3. âœ… **ì‹œê°ì  êµ¬ë¶„**: ìƒ‰ìƒìœ¼ë¡œ ìƒíƒœ ì¦‰ì‹œ íŒŒì•…
4. âœ… **ë°ì´í„° ê²€ì¦**: ì˜ëª»ëœ ì…ë ¥ ë°©ì§€

### ë°ì´í„° ê´€ë¦¬ í–¥ìƒ
1. âœ… **ìë™ ì¡°íšŒ**: VLOOKUPìœ¼ë¡œ ê´€ë ¨ ì •ë³´ ìë™ í‘œì‹œ
2. âœ… **ë°ì´í„° ë¬´ê²°ì„±**: ë“œë¡­ë‹¤ìš´ìœ¼ë¡œ ì¼ê´€ëœ ë°ì´í„° ì…ë ¥
3. âœ… **ë³€ê²½ ì´ë ¥**: ìˆ˜ì •ì¼ ìë™ ê¸°ë¡
4. âœ… **ì¶©ëŒ ë°©ì§€**: ë™ì‹œ í¸ì§‘ ì‹œ ì¶©ëŒ ê°ì§€

### ìš´ì˜ íš¨ìœ¨ì„±
1. âœ… **ìë™í™”**: ìˆ˜ë™ ì…ë ¥ ìµœì†Œí™”
2. âœ… **ì‹¤ì‹œê°„ ê³µìœ **: íŒ€ì› ê°„ ì¦‰ì‹œ ì •ë³´ ê³µìœ 
3. âœ… **ëª¨ë°”ì¼ ì§€ì›**: ì–´ë””ì„œë‚˜ í˜„ì¥ ê´€ë¦¬
4. âœ… **í™•ì¥ ê°€ëŠ¥**: 225ê°œ í˜„ì¥ìœ¼ë¡œ ì‰½ê²Œ í™•ì¥

---

## ğŸ“ ë‹¤ìŒ ì‹¤í–‰ ë‹¨ê³„

### ì¦‰ì‹œ ì‹œì‘ ê°€ëŠ¥í•œ ì‘ì—…
1. **ë°ì´í„° ê²€ì¦ ê·œì¹™ ì ìš© ìŠ¤í¬ë¦½íŠ¸ ê°œë°œ**
   ```bash
   python apply_data_validation.py
   ```

2. **VLOOKUP ìˆ˜ì‹ ì¶”ê°€ ìŠ¤í¬ë¦½íŠ¸ ê°œë°œ**
   ```bash
   python apply_formulas.py
   ```

3. **Flask API ì„œë²„ ê¸°ë³¸ êµ¬ì¡° ì‘ì„±**
   ```bash
   python sheets_to_app_api.py
   ```

---

## ğŸ’¡ ì„±ê³µ ê¸°ì¤€

### Phase 2 ì™„ë£Œ ì¡°ê±´
- [ ] ë°ì´í„° ê²€ì¦ ê·œì¹™ 100% ì ìš©
- [ ] ì¡°ê±´ë¶€ ì„œì‹ 100% ì ìš©
- [ ] VLOOKUP ìˆ˜ì‹ ì •ìƒ ì‘ë™
- [ ] API ì„œë²„ ì •ìƒ êµ¬ë™
- [ ] HTML ì•±ê³¼ API ì •ìƒ ì—°ë™
- [ ] ì†Œì¥ ë°°ì • ê¸°ëŠ¥ ì •ìƒ ì‘ë™
- [ ] í†µí•© í…ŒìŠ¤íŠ¸ í†µê³¼ìœ¨ 100%

---

**ì‘ì„±ì¼**: 2026ë…„ 1ì›”  
**ë²„ì „**: 2.0  
**ìƒíƒœ**: ì¤€ë¹„ ì™„ë£Œ âœ…

# 조건부 서식 (Conditional Formatting) 개발 가이드

## 🎯 목표
데이터의 상태를 색상으로 시각화하여 직관적인 현황 파악 가능

---

## 🎨 색상 코드 정의

### 기본 색상 팔레트

| 상태 | 색상 | RGB | 용도 |
|------|------|-----|------|
| 정상/완료 | 연한 초록 | `#d9ead3` | 배정완료, 투입가능, 사용가능 |
| 진행중 | 연한 노랑 | `#fff2cc` | 투입중, 사용중 |
| 대기/허가 | 연한 파랑 | `#cfe2f3` | 건축허가 |
| 주의 | 연한 주황 | `#fce5cd` | 착공예정, 착공중 |
| 경고 | 연한 빨강 | `#f4cccc` | 미배정, 만료 |
| 비활성 | 연한 회색 | `#efefef` | 휴가, 퇴사 |

### Google Sheets API RGB 형식
```python
# 연한 초록
{'red': 0.85, 'green': 0.92, 'blue': 0.83}

# 연한 노랑
{'red': 1.0, 'green': 0.95, 'blue': 0.8}

# 연한 파랑
{'red': 0.81, 'green': 0.89, 'blue': 0.95}

# 연한 주황
{'red': 0.99, 'green': 0.9, 'blue': 0.8}

# 연한 빨강
{'red': 0.96, 'green': 0.8, 'blue': 0.8}

# 연한 회색
{'red': 0.94, 'green': 0.94, 'blue': 0.94}
```

---

## 📋 적용할 조건부 서식 목록

### 시트1: 현장정보 (11개 규칙)

| 컬럼 | 조건 | 색상 | 설명 |
|------|------|------|------|
| O | 배정상태 = "배정완료" | 연한 초록 | 소장 배정 완료 |
| O | 배정상태 = "미배정" | 연한 빨강 | 소장 미배정 (주의) |
| J | 현장상태 = "건축허가" | 연한 파랑 | 허가 대기 |
| J | 현장상태 = "착공예정" | 연한 주황 | 착공 대기 |
| J | 현장상태 = "착공중" | 연한 노랑 | 공사 진행중 |
| J | 현장상태 = "준공" | 연한 초록 | 준공 완료 |
| H | 착공예정일 < 오늘 | 진한 빨강 | 착공일 지남 (긴급) |
| C | 회사구분 = "더존종합건설" | 옅은 파랑 | 종합건설 구분 |
| C | 회사구분 = "더존하우징" | 옅은 주황 | 하우징 구분 |
| 전체 | 헤더 행 (1행) | 회색 배경 | 헤더 강조 |
| 전체 | 홀수 행 | 옅은 회색 | 줄무늬 효과 |

### 시트2: 인력풀 (7개 규칙)

| 컬럼 | 조건 | 색상 | 설명 |
|------|------|------|------|
| H | 현재상태 = "투입가능" | 연한 초록 | 배정 가능 |
| H | 현재상태 = "투입중" | 연한 노랑 | 현장 투입중 |
| H | 현재상태 = "휴가" | 연한 회색 | 휴가중 |
| H | 현재상태 = "퇴사" | 연한 빨강 | 퇴사자 |
| I | 현재담당현장수 >= 3 | 연한 주황 | 다수 현장 담당 |
| 전체 | 헤더 행 (1행) | 회색 배경 | 헤더 강조 |
| 전체 | 홀수 행 | 옅은 회색 | 줄무늬 효과 |

### 시트3: 자격증풀 (6개 규칙)

| 컬럼 | 조건 | 색상 | 설명 |
|------|------|------|------|
| J | 사용가능여부 = "사용가능" | 연한 초록 | 배정 가능 |
| J | 사용가능여부 = "사용중" | 연한 노랑 | 현장 사용중 |
| J | 사용가능여부 = "만료" | 연한 빨강 | 유효기간 만료 |
| I | 유효기간 < 오늘 | 진한 빨강 | 만료됨 (긴급) |
| 전체 | 헤더 행 (1행) | 회색 배경 | 헤더 강조 |
| 전체 | 홀수 행 | 옅은 회색 | 줄무늬 효과 |

**총 24개 조건부 서식 규칙**

---

## 🔧 구현 방법

### 1. 단순 텍스트 매칭 (TEXT_EQ)

**API 요청 구조**:
```python
{
    'addConditionalFormatRule': {
        'rule': {
            'ranges': [{
                'sheetId': sheet_id,
                'startRowIndex': 1,      # 2행부터
                'endRowIndex': 1000,
                'startColumnIndex': col_index,
                'endColumnIndex': col_index + 1
            }],
            'booleanRule': {
                'condition': {
                    'type': 'TEXT_EQ',
                    'values': [{
                        'userEnteredValue': '매칭할 텍스트'
                    }]
                },
                'format': {
                    'backgroundColor': {
                        'red': 0.85,
                        'green': 0.92,
                        'blue': 0.83
                    }
                }
            }
        },
        'index': 0  # 규칙 우선순위 (0이 최우선)
    }
}
```

**실제 적용 예시 - 배정완료**:
```python
def create_status_assigned_format(sheet_id):
    """배정완료 상태에 초록색 적용"""
    return {
        'addConditionalFormatRule': {
            'rule': {
                'ranges': [{
                    'sheetId': sheet_id,
                    'startRowIndex': 1,
                    'endRowIndex': 1000,
                    'startColumnIndex': 14,  # O열
                    'endColumnIndex': 15
                }],
                'booleanRule': {
                    'condition': {
                        'type': 'TEXT_EQ',
                        'values': [{
                            'userEnteredValue': '배정완료'
                        }]
                    },
                    'format': {
                        'backgroundColor': {
                            'red': 0.85,
                            'green': 0.92,
                            'blue': 0.83
                        }
                    }
                }
            },
            'index': 0
        }
    }
```

---

### 2. 텍스트 포함 (TEXT_CONTAINS)

**용도**: "착공"이라는 단어가 포함된 모든 값 (착공예정, 착공중 등)

```python
{
    'condition': {
        'type': 'TEXT_CONTAINS',
        'values': [{
            'userEnteredValue': '착공'
        }]
    },
    'format': {
        'backgroundColor': {
            'red': 0.99,
            'green': 0.9,
            'blue': 0.8
        }
    }
}
```

---

### 3. 날짜 비교 (CUSTOM_FORMULA)

**용도**: 착공예정일이 지났는지 체크

```python
def create_overdue_date_format(sheet_id, col_index, col_letter):
    """날짜가 오늘보다 이전인 경우 빨간색"""
    return {
        'addConditionalFormatRule': {
            'rule': {
                'ranges': [{
                    'sheetId': sheet_id,
                    'startRowIndex': 1,
                    'endRowIndex': 1000,
                    'startColumnIndex': col_index,
                    'endColumnIndex': col_index + 1
                }],
                'booleanRule': {
                    'condition': {
                        'type': 'CUSTOM_FORMULA',
                        'values': [{
                            'userEnteredValue': f'=AND(NOT(ISBLANK({col_letter}2)), {col_letter}2<TODAY())'
                        }]
                    },
                    'format': {
                        'backgroundColor': {
                            'red': 1.0,
                            'green': 0.4,
                            'blue': 0.4
                        },
                        'textFormat': {
                            'foregroundColor': {
                                'red': 1.0,
                                'green': 1.0,
                                'blue': 1.0
                            },
                            'bold': True
                        }
                    }
                }
            },
            'index': 0
        }
    }
```

---

### 4. 숫자 비교 (NUMBER_GREATER_THAN_EQ)

**용도**: 담당현장수가 3개 이상인 경우

```python
def create_high_workload_format(sheet_id):
    """담당현장수 3개 이상 시 주황색"""
    return {
        'addConditionalFormatRule': {
            'rule': {
                'ranges': [{
                    'sheetId': sheet_id,
                    'startRowIndex': 1,
                    'endRowIndex': 1000,
                    'startColumnIndex': 8,  # I열
                    'endColumnIndex': 9
                }],
                'booleanRule': {
                    'condition': {
                        'type': 'NUMBER_GREATER_THAN_EQ',
                        'values': [{
                            'userEnteredValue': '3'
                        }]
                    },
                    'format': {
                        'backgroundColor': {
                            'red': 0.99,
                            'green': 0.9,
                            'blue': 0.8
                        }
                    }
                }
            },
            'index': 0
        }
    }
```

---

### 5. 헤더 행 서식 (고정 범위)

```python
def create_header_format(sheet_id):
    """헤더 행 회색 배경 + 굵게"""
    return {
        'repeatCell': {
            'range': {
                'sheetId': sheet_id,
                'startRowIndex': 0,
                'endRowIndex': 1,  # 1행만
            },
            'cell': {
                'userEnteredFormat': {
                    'backgroundColor': {
                        'red': 0.95,
                        'green': 0.95,
                        'blue': 0.95
                    },
                    'textFormat': {
                        'bold': True,
                        'fontSize': 10
                    },
                    'horizontalAlignment': 'CENTER',
                    'verticalAlignment': 'MIDDLE'
                }
            },
            'fields': 'userEnteredFormat(backgroundColor,textFormat,horizontalAlignment,verticalAlignment)'
        }
    }
```

---

### 6. 줄무늬 효과 (홀수 행)

```python
def create_striped_rows_format(sheet_id):
    """홀수 행에 옅은 회색 배경"""
    return {
        'addConditionalFormatRule': {
            'rule': {
                'ranges': [{
                    'sheetId': sheet_id,
                    'startRowIndex': 1,
                    'endRowIndex': 1000
                }],
                'booleanRule': {
                    'condition': {
                        'type': 'CUSTOM_FORMULA',
                        'values': [{
                            'userEnteredValue': '=MOD(ROW(),2)=1'
                        }]
                    },
                    'format': {
                        'backgroundColor': {
                            'red': 0.98,
                            'green': 0.98,
                            'blue': 0.98
                        }
                    }
                }
            },
            'index': 100  # 낮은 우선순위
        }
    }
```

---

## 📝 완성된 스크립트

### 시트1: 현장정보 서식 적용

```python
def apply_sheet1_formatting(service, sheet_id):
    """시트1 조건부 서식 모두 적용"""
    requests = []
    
    # 1. 헤더 행 서식
    requests.append(create_header_format(sheet_id))
    
    # 2. 배정상태 서식
    requests.append({
        'addConditionalFormatRule': {
            'rule': {
                'ranges': [{'sheetId': sheet_id, 'startRowIndex': 1, 'endRowIndex': 1000, 
                           'startColumnIndex': 14, 'endColumnIndex': 15}],
                'booleanRule': {
                    'condition': {'type': 'TEXT_EQ', 'values': [{'userEnteredValue': '배정완료'}]},
                    'format': {'backgroundColor': {'red': 0.85, 'green': 0.92, 'blue': 0.83}}
                }
            },
            'index': 0
        }
    })
    
    requests.append({
        'addConditionalFormatRule': {
            'rule': {
                'ranges': [{'sheetId': sheet_id, 'startRowIndex': 1, 'endRowIndex': 1000,
                           'startColumnIndex': 14, 'endColumnIndex': 15}],
                'booleanRule': {
                    'condition': {'type': 'TEXT_EQ', 'values': [{'userEnteredValue': '미배정'}]},
                    'format': {'backgroundColor': {'red': 0.96, 'green': 0.8, 'blue': 0.8}}
                }
            },
            'index': 1
        }
    })
    
    # 3. 현장상태 서식
    status_colors = {
        '건축허가': {'red': 0.81, 'green': 0.89, 'blue': 0.95},
        '착공예정': {'red': 0.99, 'green': 0.9, 'blue': 0.8},
        '착공중': {'red': 1.0, 'green': 0.95, 'blue': 0.8},
        '준공': {'red': 0.85, 'green': 0.92, 'blue': 0.83}
    }
    
    for idx, (status, color) in enumerate(status_colors.items()):
        requests.append({
            'addConditionalFormatRule': {
                'rule': {
                    'ranges': [{'sheetId': sheet_id, 'startRowIndex': 1, 'endRowIndex': 1000,
                               'startColumnIndex': 9, 'endColumnIndex': 10}],
                    'booleanRule': {
                        'condition': {'type': 'TEXT_EQ', 'values': [{'userEnteredValue': status}]},
                        'format': {'backgroundColor': color}
                    }
                },
                'index': 2 + idx
            }
        })
    
    # 4. 착공예정일 지남 경고
    requests.append({
        'addConditionalFormatRule': {
            'rule': {
                'ranges': [{'sheetId': sheet_id, 'startRowIndex': 1, 'endRowIndex': 1000,
                           'startColumnIndex': 7, 'endColumnIndex': 8}],
                'booleanRule': {
                    'condition': {
                        'type': 'CUSTOM_FORMULA',
                        'values': [{'userEnteredValue': '=AND(NOT(ISBLANK(H2)), H2<TODAY())'}]
                    },
                    'format': {
                        'backgroundColor': {'red': 1.0, 'green': 0.4, 'blue': 0.4},
                        'textFormat': {
                            'foregroundColor': {'red': 1.0, 'green': 1.0, 'blue': 1.0},
                            'bold': True
                        }
                    }
                }
            },
            'index': 6
        }
    })
    
    # 5. 회사구분 배경색
    requests.append({
        'addConditionalFormatRule': {
            'rule': {
                'ranges': [{'sheetId': sheet_id, 'startRowIndex': 1, 'endRowIndex': 1000,
                           'startColumnIndex': 2, 'endColumnIndex': 3}],
                'booleanRule': {
                    'condition': {'type': 'TEXT_EQ', 'values': [{'userEnteredValue': '더존종합건설'}]},
                    'format': {'backgroundColor': {'red': 0.9, 'green': 0.95, 'blue': 1.0}}
                }
            },
            'index': 7
        }
    })
    
    requests.append({
        'addConditionalFormatRule': {
            'rule': {
                'ranges': [{'sheetId': sheet_id, 'startRowIndex': 1, 'endRowIndex': 1000,
                           'startColumnIndex': 2, 'endColumnIndex': 3}],
                'booleanRule': {
                    'condition': {'type': 'TEXT_EQ', 'values': [{'userEnteredValue': '더존하우징'}]},
                    'format': {'backgroundColor': {'red': 1.0, 'green': 0.95, 'blue': 0.9}}
                }
            },
            'index': 8
        }
    })
    
    # 6. 줄무늬 효과
    requests.append(create_striped_rows_format(sheet_id))
    
    return requests
```

### 시트2: 인력풀 서식 적용

```python
def apply_sheet2_formatting(service, sheet_id):
    """시트2 조건부 서식 모두 적용"""
    requests = []
    
    # 헤더 행
    requests.append(create_header_format(sheet_id))
    
    # 현재상태 서식
    status_formats = [
        ('투입가능', {'red': 0.85, 'green': 0.92, 'blue': 0.83}, 0),
        ('투입중', {'red': 1.0, 'green': 0.95, 'blue': 0.8}, 1),
        ('휴가', {'red': 0.94, 'green': 0.94, 'blue': 0.94}, 2),
        ('퇴사', {'red': 0.96, 'green': 0.8, 'blue': 0.8}, 3)
    ]
    
    for status, color, idx in status_formats:
        requests.append({
            'addConditionalFormatRule': {
                'rule': {
                    'ranges': [{'sheetId': sheet_id, 'startRowIndex': 1, 'endRowIndex': 1000,
                               'startColumnIndex': 7, 'endColumnIndex': 8}],
                    'booleanRule': {
                        'condition': {'type': 'TEXT_EQ', 'values': [{'userEnteredValue': status}]},
                        'format': {'backgroundColor': color}
                    }
                },
                'index': idx
            }
        })
    
    # 다수 현장 담당 경고
    requests.append({
        'addConditionalFormatRule': {
            'rule': {
                'ranges': [{'sheetId': sheet_id, 'startRowIndex': 1, 'endRowIndex': 1000,
                           'startColumnIndex': 8, 'endColumnIndex': 9}],
                'booleanRule': {
                    'condition': {'type': 'NUMBER_GREATER_THAN_EQ', 'values': [{'userEnteredValue': '3'}]},
                    'format': {'backgroundColor': {'red': 0.99, 'green': 0.9, 'blue': 0.8}}
                }
            },
            'index': 4
        }
    })
    
    # 줄무늬
    requests.append(create_striped_rows_format(sheet_id))
    
    return requests
```

### 시트3: 자격증풀 서식 적용

```python
def apply_sheet3_formatting(service, sheet_id):
    """시트3 조건부 서식 모두 적용"""
    requests = []
    
    # 헤더 행
    requests.append(create_header_format(sheet_id))
    
    # 사용가능여부 서식
    avail_formats = [
        ('사용가능', {'red': 0.85, 'green': 0.92, 'blue': 0.83}, 0),
        ('사용중', {'red': 1.0, 'green': 0.95, 'blue': 0.8}, 1),
        ('만료', {'red': 0.96, 'green': 0.8, 'blue': 0.8}, 2)
    ]
    
    for status, color, idx in avail_formats:
        requests.append({
            'addConditionalFormatRule': {
                'rule': {
                    'ranges': [{'sheetId': sheet_id, 'startRowIndex': 1, 'endRowIndex': 1000,
                               'startColumnIndex': 9, 'endColumnIndex': 10}],
                    'booleanRule': {
                        'condition': {'type': 'TEXT_EQ', 'values': [{'userEnteredValue': status}]},
                        'format': {'backgroundColor': color}
                    }
                },
                'index': idx
            }
        })
    
    # 유효기간 만료 경고
    requests.append({
        'addConditionalFormatRule': {
            'rule': {
                'ranges': [{'sheetId': sheet_id, 'startRowIndex': 1, 'endRowIndex': 1000,
                           'startColumnIndex': 8, 'endColumnIndex': 9}],
                'booleanRule': {
                    'condition': {
                        'type': 'CUSTOM_FORMULA',
                        'values': [{'userEnteredValue': '=AND(NOT(ISBLANK(I2)), I2<TODAY())'}]
                    },
                    'format': {
                        'backgroundColor': {'red': 1.0, 'green': 0.4, 'blue': 0.4},
                        'textFormat': {
                            'foregroundColor': {'red': 1.0, 'green': 1.0, 'blue': 1.0},
                            'bold': True
                        }
                    }
                }
            },
            'index': 3
        }
    })
    
    # 줄무늬
    requests.append(create_striped_rows_format(sheet_id))
    
    return requests
```

---

## 🧪 테스트 방법

### 시각적 테스트
```
1. Google Sheets 열기
2. 시트1의 O열 확인
   - "배정완료" → 초록색 ✅
   - "미배정" → 빨간색 ✅
3. 시트1의 J열 확인
   - "건축허가" → 파란색 ✅
   - "착공예정" → 주황색 ✅
4. 시트2의 H열 확인
   - "투입가능" → 초록색 ✅
   - "투입중" → 노란색 ✅
```

### 동적 테스트
```
1. 배정상태를 "미배정"으로 변경
2. 즉시 빨간색으로 변경됨 ✅
3. 다시 "배정완료"로 변경
4. 즉시 초록색으로 변경됨 ✅
```

---

## 🎯 체크리스트

실행 전:
- [ ] 데이터 검증 규칙 먼저 적용 완료
- [ ] 시트 이름 확인 (시트1, 시트2, 시트3)
- [ ] 기존 서식 백업 (필요시)

실행 후:
- [ ] 24개 조건부 서식 모두 적용
- [ ] 색상이 올바르게 표시됨
- [ ] 헤더 행 서식 확인
- [ ] 줄무늬 효과 확인
- [ ] 기존 데이터 영향 없음

---

## 💡 사용자 경험 향상 팁

### 1. 색상 일관성
- 초록 = 좋음/정상
- 노랑 = 진행중
- 주황 = 주의
- 빨강 = 경고/문제

### 2. 우선순위 설정
- 경고 색상(빨강)을 최우선으로
- 줄무늬는 최하위 우선순위로

### 3. 가독성
- 너무 진한 색상 지양
- 텍스트가 잘 읽히는 색상 선택

---

**완료 시간**: 약 30분  
**난이도**: ⭐⭐☆☆☆  
**다음 단계**: VLOOKUP 수식 적용

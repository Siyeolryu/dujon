# 로직 디자인 계획서 — DB·프론트엔드 호환

**목적**: DB 담당 AI와 프론트엔드 담당 AI가 동일한 규칙으로 작업할 수 있도록, **단일 계약(API)** 과 **필드/값 매핑**을 정의한 직관적인 로직 설계 문서입니다.

**작성일**: 2026-01-30  
**대상**: DB(Google Sheets) 설계·API·프론트엔드(HTML/JS) 개발

---

## 1. 원칙: 단일 계약(API) 중심

```
┌──────────────────┐         ┌──────────────────┐         ┌──────────────────┐
│   DB (Sheets)    │  ←→     │   API (계약)     │  ←→     │  프론트엔드      │
│   한글 컬럼명     │         │   한글 키 유지    │         │  API 응답 그대로  │
│   시트1/2/3      │         │   또는 변환 규칙  │         │  또는 매핑 레이어 │
└──────────────────┘         └──────────────────┘         └──────────────────┘
       ↑                                ↑
   DB 담당 AI                    이 문서 = 계약
   (컬럼/값 규칙 준수)            (요청/응답 스키마)
```

- **DB 담당**: 시트 구조·컬럼명·허용값만 이 문서의 “DB 규칙”에 맞춥니다. API 키 이름을 바꾸지 않아도 됩니다.
- **프론트엔드 담당**: API 응답 스키마를 이 문서의 “API 계약”으로 사용합니다. 필요 시 “프론트 필드명” 매핑으로 표시/입력만 처리합니다.
- **API**: DB와 프론트 사이의 **유일한 데이터 계약**입니다. 필드명·타입·허용값을 이 문서에 맞춥니다.

---

## 2. 용어·필드 매핑 (한 곳에서 정의)

아래 표가 **진실의 원천**입니다. DB는 “DB 컬럼/값”, API는 “API 키/값”, 프론트는 “프론트 키/값”만 사용하면 됩니다.

### 2.1 현장(Site)

| 의미 | DB (시트1) 컬럼/값 | API 요청·응답 키/값 | 프론트 표시용 키/값 (선택) |
|------|---------------------|----------------------|----------------------------|
| 식별자 | 현장ID | 현장ID | id |
| 이름 | 현장명 | 현장명 | name |
| 회사 | 회사구분: `더존종합건설` \| `더존하우징` | 회사구분 (동일) | company: `종합` \| `하우징` (표시 시 매핑) |
| 주소 | 주소 | 주소 | address |
| 위도 | 위도 (숫자) | 위도 (숫자 또는 문자열) | lat |
| 경도 | 경도 (숫자) | 경도 (숫자 또는 문자열) | lng |
| 건축허가일 | 건축허가일 (YYYY-MM-DD) | 건축허가일 | permitDate |
| 착공예정일 | 착공예정일 | 착공예정일 | startDate |
| 준공일 | 준공일 | 준공일 | completionDate |
| 현장 상태 | 현장상태: `건축허가` \| `착공예정` \| `착공중` \| `준공` | 현장상태 (동일) | siteStatus |
| 특이사항 | 특이사항 | 특이사항 | specialNotes |
| 담당 소장 ID | 담당소장ID | 담당소장ID | (표시용: manager.id) |
| 담당 소장 명 | (VLOOKUP 등) 담당소장명 | 담당소장명 | manager.name |
| 담당 소장 연락처 | 담당소장연락처 | 담당소장연락처 | manager.phone |
| 사용 자격증 ID | 사용자격증ID | 사용자격증ID | certificate.id |
| 자격증명 | 자격증명 | 자격증명 | certificate.name |
| 자격증 소유자 명 | 자격증소유자명 | 자격증소유자명 | certificate.owner |
| 자격증 소유자 연락처 | 자격증소유자연락처 | 자격증소유자연락처 | certificate.phone |
| 준공필증 URL | 준공필증파일URL | 준공필증파일URL | completionCertFile |
| 배정 상태 | 배정상태: `배정완료` \| `미배정` | 배정상태 (동일) | status |
| 등록/수정일 | 등록일, 수정일 | 등록일, 수정일 | (필요 시) |

**회사구분 값 매핑 (API ↔ 프론트 표시)**  
- API 값 `더존종합건설` → 프론트 표시/필터: `종합`  
- API 값 `더존하우징` → 프론트 표시/필터: `하우징`  
- **DB·API는 반드시** `더존종합건설`, `더존하우징` 만 사용. 프론트는 조회/필터 시에만 `종합`/`하우징`으로 변환.

### 2.2 인력(Personnel)

| 의미 | DB (시트2) 컬럼/값 | API 키/값 | 프론트 (필요 시) |
|------|---------------------|-----------|------------------|
| 식별자 | 인력ID | 인력ID | id |
| 성명 | 성명 | 성명 | name |
| 직책 | 직책: `소장` \| `사무실장` \| `사무직원` \| `기타` | 직책 (동일) | role |
| 소속 | 소속 | 소속 | affiliation |
| 연락처 | 연락처 | 연락처 | phone |
| 현재상태 | 현재상태: `투입가능` \| `투입중` \| `휴가` \| `퇴사` | 현재상태 (동일) | state |
| 현재담당현장수 | 현재담당현장수 (숫자) | 현재담당현장수 | assignedCount |

### 2.3 자격증(Certificate)

| 의미 | DB (시트3) 컬럼/값 | API 키/값 | 프론트 (필요 시) |
|------|---------------------|-----------|------------------|
| 식별자 | 자격증ID | 자격증ID | id |
| 자격증명 | 자격증명 | 자격증명 | name |
| 소유자ID | 소유자ID | 소유자ID | ownerId |
| 소유자명 | 소유자명 | 소유자명 | ownerName |
| 소유자연락처 | 소유자연락처 | 소유자연락처 | ownerPhone |
| 사용가능여부 | 사용가능여부: `사용가능` \| `사용중` \| `만료` | 사용가능여부 (동일) | availability |
| 현재사용현장ID | 현재사용현장ID | 현재사용현장ID | currentSiteId |

---

## 3. API 계약 (요청/응답 스키마)

DB·프론트 양쪽은 아래 스키마를 “계약”으로 따릅니다.

### 3.1 현장 목록 조회

- **요청**: `GET /api/sites?company=&status=&state=`
  - `company`: (선택) `더존종합건설` \| `더존하우징`
  - `status`: (선택) `배정완료` \| `미배정`
  - `state`: (선택) `건축허가` \| `착공예정` \| `착공중` \| `준공`

- **응답**: `{ "success": true, "data": [ SiteRow ], "count": N }`  
  - `SiteRow`: 2.1표의 “API 키” 기준 한 행 (한글 키, DB와 동일 값).

### 3.2 현장 상세 조회

- **요청**: `GET /api/sites/{현장ID}`

- **응답**: `{ "success": true, "data": SiteDetail }`  
  - `SiteDetail`: 기본 현장 필드 + (있을 경우)
    - `manager`: `{ "id": "P001", "name": "김현장", "phone": "010-..." }`
    - `certificate`: `{ "id": "C001", "name": "건축기사", "owner": "김현장", "phone": "010-..." }`

### 3.3 소장 배정

- **요청**: `POST /api/sites/{현장ID}/assign`  
  - Body: `{ "담당소장ID": "P001", "사용자격증ID": "C001" }`  
  - 둘 다 필수는 아님. 소장만 배정하거나, 자격증만 배정 가능(문서 4.2 참고).

- **응답**: `{ "success": true, "data": SiteDetail }` (갱신된 현장 상세)

### 3.4 배정 해제

- **요청**: `POST /api/sites/{현장ID}/unassign`  
- **응답**: `{ "success": true, "data": SiteDetail }`

### 3.5 인력/자격증 목록 (배정 UI용)

- `GET /api/personnel?직책=소장&현재상태=투입가능` → 투입 가능 소장 목록  
- `GET /api/certificates?사용가능여부=사용가능` → 사용 가능 자격증 목록  

응답은 각각 2.2, 2.3의 API 키/값을 따릅니다.

---

## 4. 비즈니스 로직 규칙 (DB·API·프론트 공통)

아래 규칙을 **DB 검증·API 로직·프론트 유효성**에서 동일하게 적용합니다.

### 4.1 배정상태 결정 규칙

- **배정완료**: `담당소장ID` 또는 `사용자격증ID` 중 **최소 하나**가 비어 있지 않음.  
  (소장만 있거나, 자격증만 있거나, 둘 다 있으면 “배정완료”.)
- **미배정**: `담당소장ID`와 `사용자격증ID` **둘 다** 비어 있음.

DB 담당: 시트에서 “배정상태” 컬럼은 위 규칙에 맞게 유지하거나, 수식/트리거로 동기화.  
API 담당: 배정/해제 시 위 규칙으로 `배정상태` 값을 갱신해 저장.  
프론트 담당: 목록/상세에서 `배정상태`로 뱃지·필터만 하면 됨.

### 4.2 소장 배정 시 제약

- `담당소장ID`: 반드시 **인력풀(시트2)** 에 존재하는 `인력ID`.
- `사용자격증ID`: 반드시 **자격증풀(시트3)** 에 존재하는 `자격증ID`.
- 자격증의 `사용가능여부`가 `사용중`이면 다른 현장에 이미 배정된 것이므로, **새로 배정 시** `사용가능`인 자격증만 선택 가능 (API에서 검증).
- 소장만 배정하고 자격증은 “사무직원 대여”로 나중에 넣는 경우: `사용자격증ID`만 별도로 갱신하는 API가 있으면 됨 (현재 `assign` body에 둘 다 optional로 두면 됨).

### 4.3 배정 해제 시 연동

- 현장에서 `담당소장ID`/`사용자격증ID`를 비우면:
  - 해당 인력의 `현재담당현장수` 1 감소 (해당 소장이 이 현장만 담당했을 경우).
  - 해당 자격증의 `사용가능여부` → `사용가능`, `현재사용현장ID` → 비움.

DB/API: 위 연동을 한 트랜잭션(또는 일괄 업데이트)으로 처리.  
프론트: 해제 후 목록/상세만 다시 조회하면 됨.

### 4.4 필터/검색 일치 규칙

- **회사**: `회사구분` 값 그대로 비교 (`더존종합건설`, `더존하우징`). 프론트는 드롭다운 값을 API 값에 매핑해 쿼리.
- **배정상태**: `배정완료` \| `미배정` 그대로.
- **현장상태**: `건축허가` \| `착공예정` \| `착공중` \| `준공` 그대로.
- **검색(q)**: 현장명·주소 부분 일치 (대소문자 구분 없음 권장).

---

## 5. 데이터 흐름 요약

```
[DB] 시트1/2/3 (한글 컬럼, 2.1~2.3 값 규칙)
  → 읽기/쓰기
[API] 한글 키 유지, 3절 스키마·4절 로직 적용
  → JSON 요청/응답
[프론트] 3절 응답 수신
  → 표시 시에만 2.1 “프론트 표시용” 매핑 (회사: 종합/하우징, id/name/lat/lng 등)
  → 사용자 입력 시 API 값으로 되돌려 전송 (회사: 더존종합건설/더존하우징)
```

- **DB 담당 AI**: 2절 “DB 컬럼/값” + 4절 로직만 지키면 됨.  
- **프론트엔드 담당 AI**: 3절 API 계약으로 요청/응답 처리, 2절 “프론트 표시용”으로 UI 필드명/값만 매핑.

---

## 6. 체크리스트 (호환 확인용)

### DB 담당

- [ ] 시트1 컬럼명·순서가 2.1과 일치하는가?
- [ ] 시트2/3 컬럼명·순서가 2.2, 2.3과 일치하는가?
- [ ] 회사구분/현장상태/배정상태/직책/현재상태/사용가능여부 등 허용값이 문서와 동일한가?
- [ ] 담당소장ID는 시트2 인력ID, 사용자격증ID는 시트3 자격증ID만 참조하는가?

### API 담당

- [ ] GET 응답 필드명이 2.1~2.3 “API 키”와 일치하는가?
- [ ] POST/PUT body가 3.3·3.4 및 4.2·4.3 규칙을 검증·반영하는가?
- [ ] 목록 필터 쿼리(company, status, state)가 4.4와 일치하는가?

### 프론트엔드 담당

- [ ] API 응답을 받은 뒤 “프론트 표시용” 키(id, name, company→종합/하우징 등)로만 매핑하는가?
- [ ] 배정/해제 요청 시 API에 보내는 값(더존종합건설/더존하우징, 배정상태 등)이 2.1·3.3과 일치하는가?
- [ ] 필터/검색 시 쿼리 파라미터가 3.1·4.4와 일치하는가?

---

이 문서 하나로 **DB와 프론트엔드 담당 AI가 같은 로직과 계약을 공유**할 수 있습니다. 수정 시에는 “용어·필드 매핑(2절)”과 “API 계약(3절)”, “비즈니스 로직(4절)”을 함께 맞추면 됩니다.

# 로컬호스트 확인 가이드

브라우저에서 **http://localhost:5000/** 로 현장배정 관리 시스템을 확인하는 방법입니다.

---

## 1. 한 번에 실행 (권장)

**로컬호스트_확인.bat** 을 더블클릭하세요.

- 서버( Python 또는 Node )가 새 창에서 실행됩니다.
- 약 3초 후 기본 브라우저가 **http://localhost:5000/** 로 열립니다.
- 서버 창을 닫지 마세요. 닫으면 접속이 끊깁니다.

---

## 2. 수동 실행

### 서버만 먼저 띄우기

| 방법 | 명령 | 비고 |
|------|------|------|
| Python(Flask) | `python run_api.py` 또는 **run_local.bat** | 실제 API·Google 시트 연동 |
| Node.js | `node server.js` 또는 **RUN_NODE_SERVER.bat** | Python 없이 화면·연결 확인용 |

### 브라우저에서 접속

서버가 뜬 뒤 아래 주소로 접속하세요.

| 용도 | 주소 |
|------|------|
| **메인 화면 (현장배정)** | **http://localhost:5000/** |
| API 정보 | http://localhost:5000/api-info |
| 헬스 체크 | http://localhost:5000/api/health |
| 완료 체크리스트 | http://localhost:5000/ui/완료_확인_체크리스트.html |

---

## 3. 준비 사항

- **Python 사용 시**: `pip install -r requirements_api.txt` 실행
- **Node 사용 시**: Node.js만 설치되어 있으면 됨 (API는 목 데이터)
- **Kakao 맵**: 카카오 개발자 콘솔에 `http://localhost:5000` 도메인 등록 필요

---

## 4. Streamlit 현장등록·자격증등록 → Supabase 저장

로컬에서 **현장등록**, **자격증등록** 하면 **Supabase**에 바로 저장되도록 연결되어 있습니다.

### 연결 흐름

```
Streamlit(8501) → Flask API(5000) → db_service → Supabase
```

### 테스트 전 확인

| 항목 | 확인 |
|------|------|
| `.env`에 `DB_BACKEND=supabase` (또는 비워두기, 기본값 supabase) | ☐ |
| `.env`에 `SUPABASE_URL`, `SUPABASE_KEY` 설정 | ☐ |
| Supabase에 `001_initial_tables.sql` 적용됨 (sites, personnel, certificates 테이블) | ☐ |
| `pip install -r requirements_api.txt` 및 `requirements_streamlit.txt` | ☐ |

### 실행 순서

1. **터미널 1**: `python run_api.py` → 포트 5000에서 API 실행
2. **터미널 2**: `streamlit run app_streamlit.py` → 포트 8501에서 Streamlit 실행
3. 브라우저에서 **http://localhost:8501** 접속

### 테스트 절차

1. **현장등록**: 좌측 메뉴 **현장등록** → 현장명·회사구분·주소 입력 후 **등록** → "현장이 등록되었습니다" 및 부여된 현장ID 확인
2. **자격증등록**: 좌측 메뉴 **자격증등록** → 자격증 종류·소유자 명 입력 후 **등록** → "자격증이 등록되었습니다" 확인
3. **Supabase 확인**: Supabase 대시보드 → Table Editor → `sites`, `certificates` 테이블에서 방금 입력한 행 확인

### API 연결 안 될 때

- Streamlit 첫 화면에 "API에 연결할 수 없습니다" → **Flask를 먼저** 실행했는지 확인 (`python run_api.py`)
- 등록 시 5xx 오류 → `.env`의 `SUPABASE_URL`, `SUPABASE_KEY` 및 Supabase 테이블 구조(`001_initial_tables.sql`) 확인

---

## 5. 문제 해결

- **"Python을 찾을 수 없습니다"** → Node 사용: `node server.js` 또는 **RUN_NODE_SERVER.bat**
- **페이지가 안 뜸** → 서버 창에서 에러 메시지 확인 후, 포트 5000이 다른 프로그램에 사용 중인지 확인
- **Kakao 지도가 안 보임** → 카카오 개발자 콘솔에서 JavaScript 키에 `http://localhost:5000` 허용
